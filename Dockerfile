FROM ansibleplaybookbundle/apb-base:canary

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBlY2xpcHNlLWNoZS1hcGItZGV2CmRlc2NyaXB0aW9uOiBF\
Y2xpcHNlIENoZQpiaW5kYWJsZTogZmFsc2UKYXN5bmM6IG9wdGlvbmFsCm1ldGFkYXRhOgogIHBy\
b3ZpZGVyRGlzcGxheU5hbWU6ICJSZWQgSGF0LCBJbmMuIgogIGRvY3VtZW50YXRpb25Vcmw6ICJo\
dHRwczovL3d3dy5lY2xpcHNlLm9yZy9jaGUvZG9jcy82L2NoZS9kb2NzLyIKICBpbWFnZVVybDog\
Pi0KICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9lY2xpcHNlL2NoZS1kb2NzL3Jhdy9tYXN0ZXIvc3Jj\
L21haW4vaW1hZ2VzL2NoZV9sb2dvLnBuZwogIGxvbmdEZXNjcmlwdGlvbjogIkFuIEFQQiBkZXBs\
b3lzIEVjbGlwc2UgQ2hlIHY2Lnggd2l0aCBwZXJzaXN0ZW50IHN0b3JhZ2UiCiAgZGlzcGxheU5h\
bWU6ICJFY2xpcHNlIENoZSAoREVNTykiCiAgZGVwZW5kZW5jaWVzOgogICAgLSAiZG9ja2VyLmlv\
L2VjbGlwc2UvY2hlLXNlcnZlcjpsYXRlc3QtY2VudG9zIgogICAgLSAiZG9ja2VyLmlvL2pib3Nz\
L2tleWNsb2FrLW9wZW5zaGlmdDozLjQuMy5GaW5hbCIKICAgIC0gImRvY2tlci5pby9yaHNjbC9w\
b3N0Z3Jlc3FsLTk2LXJoZWw3OmxhdGVzdCIKcGxhbnM6CiAgLSBuYW1lOiBwcm9kCiAgICBkZXNj\
cmlwdGlvbjogUGVyc2lzdGVudCBkZXBsb3ltZW50IG9mIEVjbGlwc2UgQ2hlCiAgICBmcmVlOiB0\
cnVlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IFByb2R1Y3Rpb24KICAgICAgbG9u\
Z0Rlc2NyaXB0aW9uOiAiVGhpcyBwbGFuIGRlcGxveXMgRWNsaXBzZSBDaGUgd2l0aCBwZXJzaXN0\
ZW50IHN0b3JhZ2UuIgogICAgcGFyYW1ldGVyczoKICAgICAgLSBuYW1lOiAiY2hlX2ltYWdlX3Rh\
ZyIKICAgICAgICB0aXRsZTogQ2hlIFNlcnZlciBJbWFnZSBUYWcKICAgICAgICB0eXBlOiBlbnVt\
CiAgICAgICAgZW51bTogWyJuaWdodGx5LWNlbnRvcyIsICJuaWdodGx5IiwgImxhdGVzdC1jZW50\
b3MiLCAibGF0ZXN0Il0KICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkZWZhdWx0OiAi\
bGF0ZXN0LWNlbnRvcyIKICAgICAgICBkaXNwbGF5X2dyb3VwOiBDaGUgQ29uZmlndXJhdGlvbgog\
ICAgICAtIG5hbWU6ICJjaGVfc2VydmVyX2RlcGxveW1lbnRfc3RyYWdldHkiCiAgICAgICAgdGl0\
bGU6IENoZSBEZXBsb3ltZW50IFN0cmFnZXR5CiAgICAgICAgdHlwZTogZW51bQogICAgICAgIGVu\
dW06IFsiUmVjcmVhdGUiLCAiUm9sbGluZyJdCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAg\
ICAgZGVmYXVsdDogIlJlY3JlYXRlIgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IENoZSBDb25maWd1\
cmF0aW9uCiAgICAgIC0gbmFtZTogImNoZV9zZXJ2ZXJfaW1hZ2VfcHVsbF9wb2xpY3kiCiAgICAg\
ICAgdGl0bGU6ICJDaGUgRGVwbG95bWVudENvbmZpZyBJbWFnZSBwdWxsIHBvbGljeSIKICAgICAg\
ICB0eXBlOiBlbnVtCiAgICAgICAgZW51bTogWyJBbHdheXMiLCAiSWZOb3RQcmVzZW50IiwgIk5l\
dmVyIl0KICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkZWZhdWx0OiAiSWZOb3RQcmVz\
ZW50IgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IENoZSBDb25maWd1cmF0aW9uCiAgICAgIC0gbmFt\
ZTogImNoZV9wcmVkZWZpbmVkX3N0YWNrc19yZWxvYWRfX29uX19zdGFydCIKICAgICAgICB0aXRs\
ZTogIlN0YWNrIHJlbG9hZCBvbiBzdGFydCIKICAgICAgICB0eXBlOiBib29sZWFuCiAgICAgICAg\
ZGVmYXVsdDogdHJ1ZQogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRpc3BsYXlfZ3Jv\
dXA6IENoZSBDb25maWd1cmF0aW9uCiAgICAgIC0gbmFtZTogImNoZV93b3Jrc3BhY2VfYXV0b19z\
dGFydCIKICAgICAgICB0aXRsZTogIldvcmtzcGFjZSBhdXRvIHN0YXJ0IgogICAgICAgIHR5cGU6\
IGJvb2xlYW4KICAgICAgICBkZWZhdWx0OiBmYWxzZQogICAgICAgIHJlcXVpcmVkOiBmYWxzZQog\
ICAgICAgIGRpc3BsYXlfZ3JvdXA6IENoZSBDb25maWd1cmF0aW9uCiAgICAgIC0gbmFtZTogImNo\
ZV9rZXljbG9ha19hZG1pbl91c2VybmFtZSIKICAgICAgICB0aXRsZTogS2V5Y2xvYWsgQWRtaW4g\
VXNlcm5hbWUKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogZmFsc2UKICAg\
ICAgICBkZWZhdWx0OiAiYWRtaW4iCiAgICAgICAgZGlzcGxheV9ncm91cDogS2V5Y2xvYWsgQ29u\
ZmlndXJhdGlvbgogICAgICAtIG5hbWU6ICJjaGVfa2V5Y2xvYWtfYWRtaW5fcGFzc3dvcmQiCiAg\
ICAgICAgdGl0bGU6IEtleWNsb2FrIEFkbWluIFBhc3N3b3JkCiAgICAgICAgdHlwZTogc3RyaW5n\
CiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAgICAgZGVmYXVsdDogImFkbWluIgogICAgICAg\
IGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgICBkaXNwbGF5X2dyb3VwOiBLZXljbG9hayBD\
b25maWd1cmF0aW9uCiAgICAgIC0gbmFtZTogImNoZV9rZXljbG9ha19yZWFsbSIKICAgICAgICB0\
aXRsZTogQ2hlIEtleWNsb2FrIFJlYWxtCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGVm\
YXVsdDogImNoZSIKICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkaXNwbGF5X2dyb3Vw\
OiBLZXljbG9hayBDb25maWd1cmF0aW9uCiAgICAgIC0gbmFtZTogImNoZV9rZXljbG9ha19jbGll\
bnRfX2lkIgogICAgICAgIHRpdGxlOiAiQ2hlIEtleWNsb2FrIENsaWVudCBJZCIKICAgICAgICB0\
eXBlOiBzdHJpbmcKICAgICAgICBkZWZhdWx0OiAiY2hlLXB1YmxpYyIKICAgICAgICByZXF1aXJl\
ZDogZmFsc2UKICAgICAgICBkaXNwbGF5X2dyb3VwOiBLZXljbG9hayBDb25maWd1cmF0aW9uCiAg\
ICAgIC0gbmFtZTogImNoZV9qZGJjX2RiX2hvc3QiCiAgICAgICAgdGl0bGU6IERhdGFiYXNlIGhv\
c3QKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBk\
ZWZhdWx0OiAicG9zdGdyZXMiCiAgICAgICAgZGlzcGxheV9ncm91cDogUG9zdGdyZVNRTCBEYXRh\
YmFzZSBDb25maWd1cmF0aW9uCiAgICAgIC0gbmFtZTogImNoZV9qZGJjX2RiX3BvcnQiCiAgICAg\
ICAgdGl0bGU6IERhdGFiYXNlIHBvcnQKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1\
aXJlZDogZmFsc2UKICAgICAgICBkZWZhdWx0OiAiNTQzMiIKICAgICAgICBkaXNwbGF5X2dyb3Vw\
OiBQb3N0Z3JlU1FMIERhdGFiYXNlIENvbmZpZ3VyYXRpb24KICAgICAgLSBuYW1lOiAiY2hlX2pk\
YmNfZGJfbmFtZSIKICAgICAgICB0aXRsZTogRGF0YWJhc2UgbmFtZQogICAgICAgIHR5cGU6IHN0\
cmluZwogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRlZmF1bHQ6ICJkYmNoZSIKICAg\
ICAgICBkaXNwbGF5X2dyb3VwOiBQb3N0Z3JlU1FMIERhdGFiYXNlIENvbmZpZ3VyYXRpb24KICAg\
ICAgLSBuYW1lOiAiY2hlX2pkYmNfZGJfdXNlcm5hbWUiCiAgICAgICAgdGl0bGU6IERhdGFiYXNl\
IHVzZXJuYW1lCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAg\
ICAgICAgZGVmYXVsdDogInBnY2hlIgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IFBvc3RncmVTUUwg\
RGF0YWJhc2UgQ29uZmlndXJhdGlvbgogICAgICAtIG5hbWU6ICJjaGVfamRiY19kYl9wYXNzd29y\
ZCIKICAgICAgICB0aXRsZTogRGF0YWJhc2UgcGFzc3dvcmQgKHNldCB0byBkZWZhdWx0IHBnY2hl\
cGFzc3dvcmQpCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAg\
ICAgICAgZGVmYXVsdDogInBnY2hlcGFzc3dvcmQiCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNz\
d29yZAogICAgICAgIGRpc3BsYXlfZ3JvdXA6IFBvc3RncmVTUUwgRGF0YWJhc2UgQ29uZmlndXJh\
dGlvbgogICAgICAtIG5hbWU6ICJjaGVfZGF0YV9wdmNfcXVhbnRpdHkiCiAgICAgICAgdGl0bGU6\
ICJDaGUgc2VydmVyIGRhdGEgdm9sdW1lIHNpemUiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAg\
ICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAgICAgZGVmYXVsdDogIjFHaSIKICAgICAgICBkaXNwbGF5\
X2dyb3VwOiBQZXJzaXN0ZW50IFZvbHVtZQogICAgICAtIG5hbWU6ICJjaGVfaW5mcmFfa3ViZXJu\
ZXRlc19wdmNfcHJlY3JlYXRlX19zdWJwYXRocyIKICAgICAgICB0aXRsZTogUHJlY3JlYXRlIFN1\
YnBhdGhzCiAgICAgICAgdHlwZTogYm9vbGVhbgogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAg\
ICAgIGRlZmF1bHQ6IHRydWUKICAgICAgICBkaXNwbGF5X2dyb3VwOiBQZXJzaXN0ZW50IFZvbHVt\
ZQogICAgICAtIG5hbWU6ICJjaGVfaW5mcmFfa3ViZXJuZXRlc19wdmNfcXVhbnRpdHkiCiAgICAg\
ICAgdGl0bGU6IERpc2sgcXVhbnRpdHkgZm9yIGNoZSB3b3Jrc3BhY2UKICAgICAgICB0eXBlOiBz\
dHJpbmcKICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkZWZhdWx0OiAiMUdpIgogICAg\
ICAgIGRpc3BsYXlfZ3JvdXA6IFBlcnNpc3RlbnQgVm9sdW1lCiAgICAgIC0gbmFtZTogImNoZV9p\
bmZyYV9rdWJlcm5ldGVzX3B2Y19zdHJhdGVneSIKICAgICAgICB0aXRsZTogQ29tbW9uIG9yIHVu\
aXF1ZSB2b2x1bWUgZm9yIHdvcmtzcGFjZQogICAgICAgIHR5cGU6IGVudW0KICAgICAgICBlbnVt\
OiBbJ3VuaXF1ZScsICdjb21tb24nXQogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRl\
ZmF1bHQ6ICJ1bmlxdWUiCiAgICAgICAgZGlzcGxheV9ncm91cDogUGVyc2lzdGVudCBWb2x1bWUK\
ICAgICAgLSBuYW1lOiAiY2hlX2luZnJhX2t1YmVybmV0ZXNfcHZjX25hbWUiCiAgICAgICAgdGl0\
bGU6IFdvcmtzcGFjZSBWb2x1bWUgTmFtZSAob25seSBpZiBzdHJhdGVneSBpcyBjb21tb24pCiAg\
ICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAgICAgZGVmYXVs\
dDogIiIKICAgICAgICBkaXNwbGF5X2dyb3VwOiBQZXJzaXN0ZW50IFZvbHVtZQogICAgICAtIG5h\
bWU6ICJjaGVfZGVidWdfc2VydmVyIgogICAgICAgIHRpdGxlOiBFbmFibGUgQ2hlIERlYnVnZ2lu\
ZwogICAgICAgIHR5cGU6IGJvb2xlYW4KICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBk\
ZWZhdWx0OiBmYWxzZQogICAgICAgIGRpc3BsYXlfZ3JvdXA6IERlYnVnCiAgICAgIC0gbmFtZTog\
ImNoZV9sb2dfbGV2ZWwiCiAgICAgICAgdGl0bGU6ICJDaGUgTG9nIExldmVsIgogICAgICAgIHR5\
cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRlZmF1bHQ6ICJJTkZP\
IgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IERlYnVnCg=="



COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb} && \
    find /opt/ansible/roles/keycloak-apb -type f | xargs sed -i "s/'persistent'/'prod'/g" && \
    find /opt/ansible/roles/keycloak-apb -type f | xargs sed -i "s/'ephemeral'/'dev'/g"

USER root
RUN yum install dmidecode -y

USER apb

